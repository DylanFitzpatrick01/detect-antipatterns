============================= test session starts ==============================
platform linux -- Python 3.10.6, pytest-7.2.2, pluggy-1.0.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/leon/localProgramming/new-architecture/src
collecting ... collected 7 items

test.py::test_already_locked PASSED                                      [ 14%]
test.py::test_lock_order PASSED                                          [ 28%]
test.py::test_locked_call PASSED                                         [ 42%]
test.py::test_manual_lock_unlock PASSED                                  [ 57%]
test.py::test_public_mutex_members PASSED                                [ 71%]
test.py::test_observers FAILED                                           [ 85%]
test.py::test_member_locked_in_some_methods PASSED                       [100%]

=================================== FAILURES ===================================
________________________________ test_observers ________________________________

    def test_observers():
        eventSrc = EventSource()
        eventSrc2 = EventSource()
        mutex_observer = tagObserver("std::mutex")
        lock_guard_observer = tagObserver("std::lock_guard<std::mutex>")
        declared_variable_observer = cursorKindObserver(clang.cindex.CursorKind.FIELD_DECL)
        class_observer = cursorKindObserver(clang.cindex.CursorKind.CLASS_DECL)
        function_observer = cursorKindObserver(clang.cindex.CursorKind.CXX_METHOD)
        record_observer = cursorTypeKindObserver(clang.cindex.TypeKind.RECORD)
    
        assert(eventSrc.observers) == []
        eventSrc.addMultipleObservers([mutex_observer, lock_guard_observer, declared_variable_observer, class_observer, record_observer])
        eventSrc.addObserver(function_observer)
        assert(eventSrc.observers) == [mutex_observer, lock_guard_observer, declared_variable_observer, class_observer, record_observer, function_observer]
    
        eventSrc2.addMultipleObservers([mutex_observer, lock_guard_observer, class_observer, function_observer])
        eventSrc2.removeMultipleObservers([mutex_observer, lock_guard_observer, class_observer])
        assert(eventSrc2.observers) == [function_observer]
    
    
        searchNodes(eventSrc=eventSrc, file_path="../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp")
    
        correct_output = (
            "Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 38>\n"+
            "Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 38>\n" +
            "Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>\n" +
            "Detected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 33>\n" +
            "Detected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 33>\n" +
            "Detected std::string : 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 36, column 17>\n" +
            "Detected std::mutex : 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>\n" +
            "Detected MyClass : 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>\n\n" +
            "Detected MyClass : 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>\n\n" +
            "Detected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 26>\n" +
            "Detected const std::basic_string<char> : 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 19, column 12>\n" +
            "Detected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 26>zn" +
            "Detected std::basic_string<char>: 'operator=' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 26, column 5>\n" +
            "Detected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 10>\n" +
            "Detected std::string () : 'getState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 15, column 13>\n" +
            "Detected void (const std::string &) : 'updateState(const std::string &)' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 22, column 6>\n" +
            "Detected void () : 'logState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 29, column 6>"
        )
    
        output_str = mutex_observer.output + lock_guard_observer.output + declared_variable_observer.output + class_observer.output + record_observer.output + function_observer.output
>       assert(output_str) == correct_output
E       assert "Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 38>\nDetected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 38>\nDetected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>\nDetected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 33>\nDetected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 33>\nDetected std::string: 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 36, column 17>\nDetected std::mutex: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>\nDetected MyClass: 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>\n\nDetected MyClass : 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>\n\nDetected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 26>\n\nDetected const std::basic_string<char> : 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 19, column 12>\n\nDetected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 26>\n\nDetected std::basic_string<char> : 'operator=' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 26, column 5>\n\nDetected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 10>\nDetected std::string (): 'getState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 15, column 13>\nDetected void (const std::string &): 'updateState(const std::string &)' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 22, column 6>\nDetected void (): 'logState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 29, column 6>\n" == "Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 38>\nDetected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 38>\nDetected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>\nDetected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 33>\nDetected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 33>\nDetected std::string : 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 36, column 17>\nDetected std::mutex : 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>\nDetected MyClass : 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>\n\nDetected MyClass : 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>\n\nDetected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 26>\nDetected const std::basic_string<char> : 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 19, column 12>\nDetected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 26>znDetected std::basic_string<char>: 'operator=' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 26, column 5>\nDetected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 10>\nDetected std::string () : 'getState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 15, column 13>\nDetected void (const std::string &) : 'updateState(const std::string &)' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 22, column 6>\nDetected void () : 'logState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 29, column 6>"
E           Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 38>
E           Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 38>
E           Detected a 'std::mutex', Name: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>
E           Detected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 33>
E           Detected a 'std::lock_guard<std::mutex>' Lockguard's Name: 'lock_guard' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 33>
E         - Detected std::string : 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 36, column 17>
E         ?                     -
E         + Detected std::string: 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 36, column 17>
E         - Detected std::mutex : 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>
E         ?                    -
E         + Detected std::mutex: 'mDataAccess' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 16>
E         - Detected MyClass : 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>
E         ?                 -
E         + Detected MyClass: 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>
E           
E           Detected MyClass : 'MyClass' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 5, column 7>
E           
E           Detected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 17, column 26>
E         + 
E           Detected const std::basic_string<char> : 'mState' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 19, column 12>
E         - Detected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 26>znDetected std::basic_string<char>: 'operator=' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 26, column 5>
E         + 
E         + Detected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 24, column 26>
E         + 
E         + Detected std::basic_string<char> : 'operator=' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 26, column 5>
E         + 
E           Detected std::mutex : 'class std::mutex' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 37, column 10>
E         - Detected std::string () : 'getState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 15, column 13>
E         ?                        -
E         + Detected std::string (): 'getState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 15, column 13>
E         - Detected void (const std::string &) : 'updateState(const std::string &)' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 22, column 6>
E         ?                                    -
E         + Detected void (const std::string &): 'updateState(const std::string &)' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 22, column 6>
E         - Detected void () : 'logState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 29, column 6>
E         ?                 -
E         + Detected void (): 'logState()' at <SourceLocation file '../cpp_tests/member_locked_in_some_methods/error_in_method_scope.cpp', line 29, column 6>
E         ?                                                                                                                                                  +

test.py:173: AssertionError
----------------------------- Captured stdout call -----------------------------
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
I've been called
=========================== short test summary info ============================
FAILED test.py::test_observers - assert "Detected a 'std::mutex', Name: 'mDat...
========================= 1 failed, 6 passed in 18.10s =========================
